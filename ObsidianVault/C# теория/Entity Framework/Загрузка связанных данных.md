#EF 

Есть три стратегии загрузки:
- Eager loading (жадная загрузка)    
- Explicit loading (явная загрузка)    
- Lazy loading (ленивая загрузка)

### Eager Loading(жадная загрузка)
Когда запрос на получение одной сущности, так же загружает связанную с ней сущность через навигационное свойство (с помощью метода `Include()` сделается Left Join, если нужны еще связанные данные - `ThenInclude()`)
```C#
var users = db.Users.Include(u=>u.Company).ToList();
```

### Explicit loading (явная загрузка)
Предполагает явную загрузку данных с помощью метода `Load()`
```C#
Company company = db.Companies.FirstOrDefault();
db.Users.Where(p=>p.CompanyId==company.Id).Load();
```
Это выражение загружает пользователей, у которых свойство `CompanyId` соответствует свойству `Id` ранее полученной компании в контекст. После этого нам не надо подгружать связанные данные, так как они уже есть в контексте.

Метод `Collection()` применяется, если навигационное свойство представляет коллекцию:
```C#
Company company = db.Companies.FirstOrDefault();
db.Entry(company).Collection(t=>t.Users).Load();
```

Если навигационное свойство представляет одиночный объект, то можно применять метод `Reference()`:
```C#
User user = db.Users.FirstOrDefault();
db.Entry(user).Reference(x => x.Company).Load();
```

### Lazy loading (ленивая загрузка)
Предполагает неявную автоматическую загрузку связанных данных при обращении к навигационному свойству. Однако здесь есть ряд условий:
- При конфигурации контекста(внутри `OnConfiguring()`) данных вызвать метод `UseLazyLoadingProxies()`    
- Все навигационные свойства должны быть определены как  `virtual`, при этом сами классы моделей должны быть открыты для наследования
- Добавить в проект через nuget пакет `Microsoft.EntityFrameworkCore.Proxies`

```C#
using (ApplicationContext db = new ApplicationContext())
{
    var users = db.Users.ToList();
    foreach (User user in users)
        Console.WriteLine($"{user.Name} - {user.Company?.Name}");
}
```
Подгружаем `Users` из бд, далее в цикле при обращении к навигационному свойству автоматически подтягиваются связанные с ним данные (объекты Company). Подтянутые данные сохраняются в контексте и при совпадении берутся от туда.

Однако при использовании lazy loading следует учитывать что если в базе данных произошли какие-нибудь изменения, например, другой пользователь изменил данные, то данные не перезагужаются, контекст продолжает использовать те данные, которые были ранее загружены, как собственно было показано выше.

