#ASPNET 

Middleware - связующее программное обеспечение, которое помогает приложению и серверу обмениваться друг с другом запросами.  

Middleware-компоненты настраиваются в методе Сonfigure класса запуска приложения (Startup). Метод Configure выстраивает конвейер обработки запросов в ASP.NET Core приложении. Он состоит из последовательности делегатов запросов, вызываемых один за другим.

![[Pasted image 20231227133814.png]]

Отдельно взятые Middleware сами решают отправлять запрос дальше или нет(short-circuiting) и какой выслать ответ. 

Находится на уровень выше чем Контроллер
==Так же порядок, в котором они вызываются имеет значение==

Middleware имеют точно такое время жизни как и сервисы в приложении!(Singleton, Scoped, Transient)

**app.Run()**

Этот метод добавляет middleware-компонент в виде Run(Middleware), который выполнится в конце конвейера. Как правило, он действует как замыкающее middleware и добавляется в конце конвейера запросов, поскольку не может вызывать следующий middleware-компонент.

 **app.Use()**

 Этот метод используется для конфигурирования нескольких middleware. В отличие от app.Run(), мы можем включить в него параметр next, который вызывает следующий делегат запроса в конвейере. Мы также можем замкнуть (завершить) конвейер, не вызывая параметр next.
 
 **app.Map()**

Этот метод расширения используются как условное обозначение для ветвления конвейера. Map разветвляет конвейер запросов на основе пути запроса. Если путь запроса начинается с указанного пути, ветвь выполняется.

### Создание собственного Middleware

_Middleware_ обычно инкапсулируется в класс и предоставляется с помощью метода расширения. _Middleware_ может быть создано с помощью класса с методом `InvokeAsync()` и параметром типа `RequestDelegate` в конструкторе. Тип `RequestDelegate` требуется для выполнения следующего middleware в последовательности.