#Docker 

Контейнер это набор механизмов ядра Linux, в основе **изоляция** + **контроль ресурсов**

Docker использует эти механизмы через `containerd` и `runc`
### Namespace - изоляция среды

- Изолируют окружение: процессы, сеть, точки монтирования, пользователей и тд.
- Типы:
	- `pid` - таблица процессов
	- `net` - своя сеть (интерфейсы, IP)
	- `mnt` - отдельная файловая система
	- `uts` - hostname
	- `ipc`, `user` - сообщения и ID
- У каждого контейнера  - свой набор namespace'ов
- Когда PID 1 завершает работу, контейнер умирает

> Контейнер = "маленький мир со своими законами"

### Cgroups - контроль ресурсов

- Контролируют и ограничивают:
	- CPU
	- Память
	- IO
	- Сеть
- Один контейнер не может съесть все
- Можно задать лимиты:
	- `--memory`
	- `--cpus`
	- `--blkio-weight`

> Контейнер != сосед, который сжег чайник и отключил весь щиток

### UnionFS - слои и магия слепков

- Union File System = наслоённая файловая система
- Каждый слой - отдельный snapshot:
	- `FROM ubuntu` - базовый слой
	- `RUN apt install` - новый слой
	- `COPY .` - еще один
- Легкая переиспользуемость: слои кешируются
- OverlayFS - наиболее популярная реализация 

> Контейнер - это сэндвич: база + начинки + сверху приложение

## Что происходит при запуске контейнера?

1. Docker CLI отправляет команду daemon'у
2. Daemon через `cintainerd` подготавливает контейнер
3. Слои `UnionFS` объединяются в файловую систему
4. Создаются `namespace`'ы, применяются `cgroup`'ы
5. `runc` запускает процесс внутри контейнера 

> Вы видите shell внутри Ubuntu - но вы не в виртуалке, а в изолированном процессе хоста