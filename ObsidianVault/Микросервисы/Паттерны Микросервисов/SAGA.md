#MSPatterns 

Проблема:
	Необходимо добиться согласованности данных в условиях микросервисной архитектуры, так как каждый сервис может использовать свою БД, мы теряем ACID-транзакции между сервисами
Решение:
	 1.  Two phase commit
		 Добавляем сервис Transaction Coordinator, который делает Commit всех транзаций сервисов, только если все они отработали, если хоть одна не прошла, делается Rollback всех
		 [[TwoPhaseCommit]]
		 - Ждем самую долгую транзакцию
		 - Единая точка отказа
		 - 4 раунда обмена сообщениями
	 1. SAGA
		Каждый из сервисов запускает свою транзакцию до конца, после этого он отсчитывается об этом следующему сервису и тд. Если транзакция обрывается, то сервис сообщает предыдущему сервису об этом и запускается компенсирующая транзакция
		[[SAGApattern]]
		- Цельная транзакция(сага состоит из локальных транзакций)
		- Локальная транзакция обновляет бд и шлет событие/триггер следующей
		- Сбой локалькой транзакции выполняет свой abort
		- Компенсационная транзакция


==Соответствует принципам ACID, кроме "Изоляции"!==

1. **Atomicity(атомарность)** - сага гарантирует что все транзакции либо выполнятся либо выполнятся компенсационные им
2. **Consistency(cогласованность)** - при умпешном выполнении транзакций система переходит из 1 состояния в другое, если хоть одна транзакция не проходит система возвращается в предыдущее состояние
3. **Isolation(изоляция)** - так как локальные транзакции выполняются полностью, их результаты уже видны другим транзакциями, несмотря на возможность того, что Saga завершится сбоем и откатит эти транзакции(Saga имеет уровень изоляции сравнимый с "read uncommited")
4. **Durability(надежность)** - после коммита локальных транзакций Saga их изменения сохраняются даже в случае сбоя сервиса и перезапуска

[[Замена синхронного взаимодействия между сервисами]]