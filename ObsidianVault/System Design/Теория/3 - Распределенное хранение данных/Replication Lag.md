#SystemDesign 

[[Replication-lag]]

==Задержка в репликации== - ситуация в асинхронной репликации, когда пользователь сохраняет какие-то данные и далее при попытке считать их попадает на реплику, где этих данных еще нет

### Возможные проблемы:
1. **Чтение собственных записей** (пользователь отправил пост в соц сеть, потом сразу обновил страницу и не увидел своего поста, так как его запрос попал на реплику, где данных о его посте еще нет)
>[!info]-  Решение
> Отслеживать, когда пользователь в последний раз отправлял обновление. Если он отправил обновление в течение последней минуты, то запросы на чтение должны обрабатываться главным узлом

2.  **Монотонное чтение** (пользователь обновил ленту и увидел пост, после повторного обновления, этот пост исчез, так как запрос попал на реплику, куда данные о новом посте еще не доехали)
> [!info]- Решение
> Обеспечить, чтобы каждый пользователь всегда читал из одного и того же узла-последователя (разные пользователи могут читать с разных реплик)

3. **Согласованное префиксное чтение** (если на БД применяется партиционированние и репликация, то может возникнуть ситуация, когда пользователь А сделает пост, пользователь Б напишет ответ на этот пост. Теперь между ними существует причинно-следственная связь, когда ответный пост пользователя Б не имеет смыслы, если не видно пост пользователя А - то есть пост А уехал в одну партицию со своей репликацией, а пост Б на другую партицию со своей репликацией, и пользователь может попасть на реплику где нет поста А, но есть пост Б)
> [!info]- Решение
> Гарантировать, что база данных всегда применяет операции в одном и том же порядке, а именно писать в одну и ту же секцию