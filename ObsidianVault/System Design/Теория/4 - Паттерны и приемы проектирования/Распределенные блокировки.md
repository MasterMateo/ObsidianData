#SystemDesign 

Есть ресурс\файл, которому нужно обеспечить уникальный доступ, т.е. чтобы только 1 сервис в момент времени работал с этим ресурсом.

[[distributed-bloking]]

В кеш положить какой-то ключ, если другой сервис захочет получить доступ к ресурсу, он увидит в кеше ключ и не будет его открывать.

>[!info]- Важно учесть:
> У ключа в кеше должен быть ограниченный период действия, иначе при падении сервиса ресурс будет заблокирован навечно

[[distr-bloking-example]]

Что происходит на картинке:
1. Клиент, при обращении к ресурсу, обращается в Redis с запросом вставить значение по ключу, только если значения с таким ключом уже нет(`NX`). Время "хранения" этого значения будет 30 секунд (`PX 30000`).
2. Другой клиент при попытке обращения к ресурсу так же выполняет запрос с параметром `NX`, однако запись с таким ключом уже существует. Таким образом первый клиент блокирует ресурс на время своей работы
3. Далее первый клиент идет в Redis и удаляет свою запись, чтобы освободить ресурс
4. Чтобы избежать ситуации, когда клиент удаляет запись другого клиента(в момент когда запрос на удаление пришел после конца времени жизни записи), клиент так же передает случайно сгенерированное значение в Redis, которое хранит у себя в кеше.(это может быть просто номер инстанса)