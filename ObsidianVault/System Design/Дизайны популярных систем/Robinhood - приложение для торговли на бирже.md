#SystemDesign 

1. Требования к системе
	1. Отправка ордеров
	2. Отслеживание позиции
	3. Возможность видеть корректную цену актива
	4. 100 миллионов пользователей
	5. 100 акций на пользователя
2. Начальный дизайн
	1. Пользовательский слой(сервера которые говорят с телефонами/компьютерами)
	2. Биржевой слой (сервера которые собирают данные с бирж)
	3. Слой маршрутизации(нужен чтобы избежать обеспечить высоконагруженный доступ - если 10 милиионов пользователей захотят получить данные по 1 активу)
3. Биржевой слой
	1. Необходимо показывать пользователю лучшую цену каждого актива на покупку/продажу среди множества бирж.(чтобы получить цену актива возьмем (Best bid + best ask) / 2)
	2. Шардируем биржевой слой по символьным аббревиатурам активов и будем на каждом высчитывать цену
	3. [[Алгоритм выбора лучшей цены]]
4. Пользовательский слой
	1. Надо ограничить количество подключений на 1 пользователя, так как нам придется иметь по 1 подключению на актив, что довольно затратно
	2. Для общения между клиентом и пользовательским слоем берем WebSocket (2-направленный, автоматич переподключение, быстрое получение данных в риал тайм)
	3. Так как у нас 100 милиионов пользователей, необходимо шардировать Пользовательский слой. 
	4. Балансировать нагрузку между телефонами и Пользовательским слоем с помощью алгоритма Round Robin [[Load Balancing]]
	5. При падении одного из серверов, клиентское приложение будет открывать новое подключение по WebSocket (приложение регулярно пингует сервер по WebSoсket, если сервер не отвечает, открывает новое подключение)
	6. Сделать Zookeeper сервис для мониторинга работы пользовательских серверов*
5. Слой маршрутизации
	1. Писать в Redis шардированный по активам (Записывать события в Kafka)
	2. Биржа -> Publisher BTC $40k -> Слой маршрутизации видит UPDATE цены BTC -> User Server -> Client device
	3. Реплицировать Слой маршрутизации х3 (не проблема что Publisher пишет в 3 разных места, проблема если пишет в 1000)
	4. Реплицировать Publisher, чтобы если он упал переключать работу на backup Publisher. "Запасные" Publisher'ы тоже слушают биржу, чтобы быть stateful (были готовы включиться в работу сразу при отказе основного)


[[RobinHood_Complete_Design]]